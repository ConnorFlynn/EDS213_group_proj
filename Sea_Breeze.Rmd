---
title: "Sea_Breeze"
author: "Squaaa"
date: "10/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rerddap)
library(tidyverse)
library(here)
library(lubridate)
```

```{r}
# I found the SST and Chloro data through an old co-worker who was working with the Aqua Modis satelite. # I found the buoy data by scrolling through the NOAA site. See README.md for more info about data. 

#Read in Aqua Modis Data
require("rerddap")


#SST for each Buoy
E_sst <- griddap('erdMWsstd8day_LonPM180', # 8 day composite SST E_buoy
 time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
 latitude = c(34.0, 34.5), #grid surrounding buoy
 longitude = c(-119.5, -120), #grid surrounding buoy
 fmt = "csv") 

E_sst <- E_sst %>% 
  add_column(location = "east") #add ID column

W_sst <- griddap('erdMWsstd8day_LonPM180', # 8 day composite SST W_buoy
 time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
 latitude = c(34.0, 34.5), #grid surrounding buoy
 longitude = c(-120, -120.5), #grid surrounding buoy
 fmt = "csv")

W_sst <- W_sst %>% 
  add_column(location = "west") #add ID column

SM_sst <- griddap('erdMWsstd8day_LonPM180', # 8 day composite SST SM_buoy
 time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
 latitude = c(33.5, 34.0), #grid surrounding buoy
 longitude = c(-118.75, -119.25), #grid surrounding buoy
 fmt = "csv")

SM_sst <- SM_sst %>%
  add_column(location = "SM") #add ID column

sst <- rbind(E_sst, W_sst, SM_sst) #bind data




#Chloro for each Buoy
E_chloro <- griddap('erdMWchla8day_LonPM180',  # 8 day composite Chlorophyll E_buoy
  time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
  latitude = c(34.0, 34.5), #grid surrounding buoy
  longitude = c(-119.5, -120), #grid surrounding buoy
  fmt = "csv")

W_chloro <- griddap('erdMWchla8day_LonPM180', # 8 day composite Chlorophyll E_buoy
  time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
  latitude = c(34.0, 34.5), #grid surrounding buoy
  longitude = c(-120, -120.5), #grid surrounding buoy
  fmt = "csv")

SM_chloro <- griddap('erdMWchla8day_LonPM180', # 8 day composite Chlorophyll SM_buoy
  time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
  latitude = c(33.5, 34.0), #grid surrounding buoy
  longitude = c(-118.75, -119.25), #grid surrounding buoy
  fmt = "csv")

chloro <- rbind(E_chloro, W_chloro, SM_chloro) #Bind data


#Wind data for each buoy
E_wind <- read.csv(here("data", "noaa_east_data.csv")) %>% 
  add_column(location = "east") %>% 
  select(c("X.yr", "mo", "dy", "m.s", "location")) %>% 
  rename(year = X.yr,
         month = mo,
         day = dy)
  

W_wind <- read.csv(here("data", "W_buoy_data_updated.csv" ))%>% 
  add_column(location = "west") %>% 
  select(c("X.yr", "mo", "dy", "mn.degT.m.s..m.s.....m...sec...sec..4", "location")) %>%
  rename(m.s = mn.degT.m.s..m.s.....m...sec...sec..4,
         year = X.yr,
         month = mo,
         day = dy)


  
SM_wind <- read.csv(here("data", "noaa_santa_monica_data.csv"))%>% 
  add_column(location = "SM") %>% 
  select(c("X.yr", "mo", "dy", "m.s", "location")) %>% 
  rename(year = X.yr,
         month = mo,
         day = dy)

wind <- rbind(E_wind, W_wind, SM_wind)


```


```{r}
#clean date format for wind 

wind <- wind %>%
  unite("date", year:month:day, sep = "-") %>% 
  mutate(date = ymd(date, tz = NULL)) %>% 
  mutate(m.s = as.numeric(m.s))

wind_avg <- wind %>% 
  group_by(location, date) %>% 
  summarize(mean = mean(m.s))

```


```{r}
#clean data for sst data
sst_clean <- sst %>% 
  mutate(date = ymd_hms(time, tz = "UTC")) %>% 
  mutate(ymd_date = ymd(date, tz = NULL)) %>% 
  mutate(date = ymd_date) %>% 
  select(c("latitude", "longitude", "sst", "location", "date"))
```


```{r}
#Clean sst Data
final_sst <- sst_clean %>% 
  filter(sst > 0) %>% #remove NAs
  mutate(sst = (sst * (9/5) + 32 )) %>% #convert to F
  mutate(sst = (sst - 3)) #accounting for SST Satelite error through anecdotal and buoy comparision. 


final_sst_avg <- final_sst %>% 
  group_by(location, date) %>% 
  summarize(mean = mean(sst))



```


```{r}

wind_sst <- left_join(wind, final_sst, by = c("date", "location"))

```

```{r}
#West Buoy figure (SST, Wind, Chloro(?)) <- We need monthly means

west_sst <- final_sst %>% 
  filter(location == "west") #filter for site

ggplot() +
  geom_point(data = west_sst, aes(x = time, y = sst), alpha = 0.3)


```


```{r}
#East Buoy figure (SST, Wind, Chloro(?)) <- We need monthly means

east_sst <- final_sst %>% 
  filter(location == "east") #filter for site

ggplot() +
  geom_point(data = east_sst, aes(x = time, y = sst))


```


```{r}
#Santa Monica Buoy (SST, Wind, Chloro(?)) <- We need monthly means

SM_sst <- final_sst %>% 
  filter(location == "SM") #filter for site

ggplot() +
  geom_point(data = SM_sst, aes(x = time, y = sst))



```

